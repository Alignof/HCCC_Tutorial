# 関数呼び出し

前に，「四則演算などの計算をする上で，自由に使える」として，以下の 9 本の 64 ビットレジスタを紹介しました．

```
rax
rdi
rsi
rdx
rcx
r8
r9
r10
r11
```

このうち，最初の `rax` は，関数から値を返すときに使います．その次の `rdi, rsi, rdx, rcx, r8, r9` の 6 本は，関数を呼ぶ際には，引数を渡すために使います．

| 64 ビット | 下位 32 ビット | 関数呼び出しにおける役割 |
|-----------|--------------|------|
| rax | eax | 戻り値 |
| rdi | edi | 第一引数 |
| rsi | esi | 第二引数 |
| rdx | edx | 第三引数 |
| rcx | ecx | 第四引数 |
| r8  | r8d | 第五引数 |
| r9  | r9d | 第六引数 |
| r10 | r10d | とくになし |
| r11 | r11d | とくになし |

`rdi, rsi, rdx, rcx, r8, r9` を使ってセットアップをしたあとに，`call 関数名`と書くことによって，関数を呼び出すことができます．

つまり，C 言語でいう `fun(11, 22, 33, 44, 55, 66);` という関数呼び出しは，次のようにして行うことができます．

```
mov edi, 11
mov esi, 22
mov edx, 33
mov ecx, 44
mov r8d, 55
mov r9d, 66
call fun
```

なお，printf のような可変長引数関数を呼ぶときには，引数のうち浮動小数点数のものの個数を eax レジスタに入れてください．つまり，浮動小数点を扱わない場合は，printf などを呼ぶ直前に eax に 0 を入れてください．

## rsp の選り好み

また，printf などの一部の関数は，`call` される直前の `rsp` の値に選り好みをする場合があります． 

ローカル変数の話をした際に，`rsp` からは 8 の倍数を引くように伝えておいたと思いますが，これはなぜかというと，`call` の直前の段階で，`rsp` から引かれた数が『8 × 奇数』であることを要求する関数があるからです．

お手数ですが，『8 × 奇数』になっていない場合は，関数を呼び出す前に `sub rsp, 8` をし，呼び出した直後に `add rsp, 8` をしておいてください．

# 次のセクション
[section7: 文字列・グローバル変数](/sections/section7_String.md)
